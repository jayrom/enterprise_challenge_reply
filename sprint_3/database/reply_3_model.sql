-- Limpeza inicial

DROP TABLE T_REPLY_SENSOR_READINGS CASCADE CONSTRAINTS;
DROP TABLE T_REPLY_MAINTENANCE_EVENTS CASCADE CONSTRAINTS;
DROP TABLE T_REPLY_MODEL_PREDICTIONS CASCADE CONSTRAINTS;

-- Criação de tabelas

-- Tabela para armazenar os dados de sensores
CREATE TABLE T_REPLY_SENSOR_READINGS (
    READING_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    TIMESTAMP_TMS TIMESTAMP NOT NULL,
    DEVICE_ID VARCHAR2(50) NOT NULL,
    TEMPERATURE_VL NUMBER(5, 2),
    CURRENT_VL NUMBER(5, 2),
    VIBRATION_VL NUMBER(5, 2),
    DAYS_TO_FAILURE NUMBER(5, 2),
    FAILURE_MODE VARCHAR2(50)
);

-- Primary key para T_REPLY_SENSOR_READINGS
ALTER TABLE T_REPLY_SENSOR_READINGS ADD CONSTRAINT PK_REPLY_SENSOR_READINGS PRIMARY KEY (READING_ID);

-- Índice para otimizar as consultas de série temporal
CREATE INDEX SENSOR_READINGS_TIMESTAMP_IDX ON T_REPLY_SENSOR_READINGS (TIMESTAMP_TMS);

-- Índice para otimizar buscas por dispositivo
CREATE INDEX SENSOR_READINGS_DEVICE_ID_IDX ON T_REPLY_SENSOR_READINGS (DEVICE_ID);

-- Tabela para armazenar os eventos de manutenção e falhas
CREATE TABLE T_REPLY_MAINTENANCE_EVENTS (
    EVENT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    DEVICE_ID VARCHAR2(50) NOT NULL,
    FAILURE_DATE TIMESTAMP NOT NULL,
    FAILURE_MODE VARCHAR2(100),
    DIAGNOSTIC_NOTES VARCHAR2(255)
);

-- Primary key para T_REPLY_MAINTENANCE_EVENTS
ALTER TABLE T_REPLY_MAINTENANCE_EVENTS ADD CONSTRAINT PK_REPLY_MAINTENANCE_EVENTS PRIMARY KEY (EVENT_ID);

-- Tabela para armazenar as predições do modelo
CREATE TABLE T_REPLY_MODEL_PREDICTIONS (
    PREDICTION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    TIMESTAMP TIMESTAMP NOT NULL,
    DEVICE_ID VARCHAR2(50) NOT NULL,
    PREDICTED_DAYS_TO_FAILURE NUMBER(5, 2),
    PREDICTED_FAILURE_MODE VARCHAR2(50),
    SENSOR_READING_ID NUMBER, -- Chave estrangeira para o registro que gerou a predição
    EVALUATION_STATUS VARCHAR2(20) -- Ex: 'Pending', 'Correct', 'False Positive', 'False Negative'
);

-- Primary key para T_REPLY_MODEL_PREDICTIONS
ALTER TABLE T_REPLY_MODEL_PREDICTIONS ADD CONSTRAINT PK_REPLY_MODEL_PREDICTIONS PRIMARY KEY (PREDICTION_ID);


