-- Limpeza inicial
DROP TABLE T_REPLY_MODEL_PREDICTIONS CASCADE CONSTRAINTS;
DROP TABLE T_REPLY_MAINTENANCE_EVENTS CASCADE CONSTRAINTS;
DROP TABLE T_REPLY_SENSOR_READINGS CASCADE CONSTRAINTS;

-- Tabela para armazenar os dados brutos dos sensores
CREATE TABLE T_REPLY_SENSOR_READINGS (
    READING_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    TIMESTAMP_TMS TIMESTAMP NOT NULL,
    DEVICE_ID VARCHAR2(50) NOT NULL,
    TEMPERATURE_VL NUMBER,
    CURRENT_VL NUMBER,
    VIBRATION_VL NUMBER,
    CONSTRAINT PK_REPLY_SENSOR_READINGS PRIMARY KEY (READING_ID)
);

-- Índices para otimizar consultas
CREATE INDEX SENSOR_READINGS_TIMESTAMP_IDX ON T_REPLY_SENSOR_READINGS (TIMESTAMP_TMS);
CREATE INDEX SENSOR_READINGS_DEVICE_ID_IDX ON T_REPLY_SENSOR_READINGS (DEVICE_ID);


-- Tabela para eventos de manutenção
CREATE TABLE T_REPLY_MAINTENANCE_EVENTS (
    EVENT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    DEVICE_ID VARCHAR2(50) NOT NULL,
    FAILURE_DATE TIMESTAMP NOT NULL,
    FAILURE_MODE VARCHAR2(100),
    DIAGNOSTIC_NOTES VARCHAR2(255),
    CONSTRAINT PK_REPLY_MAINTENANCE_EVENTS PRIMARY KEY (EVENT_ID)
);


-- Tabela para predições do modelo
CREATE TABLE T_REPLY_MODEL_PREDICTIONS (
    PREDICTION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    TIMESTAMP TIMESTAMP NOT NULL,
    DEVICE_ID VARCHAR2(50) NOT NULL,
    PREDICTED_DAYS_TO_FAILURE NUMBER(5, 2),
    PREDICTED_FAILURE_MODE VARCHAR2(50),
    SENSOR_READING_ID NUMBER,
    EVALUATION_STATUS VARCHAR2(20),
    CONSTRAINT PK_REPLY_MODEL_PREDICTIONS PRIMARY KEY (PREDICTION_ID),

    CONSTRAINT FK_PRED_TO_READING FOREIGN KEY (SENSOR_READING_ID)
    REFERENCES T_REPLY_SENSOR_READINGS(READING_ID)
);

CREATE INDEX PRED_SENSOR_READING_ID_IDX ON T_REPLY_MODEL_PREDICTIONS (SENSOR_READING_ID);